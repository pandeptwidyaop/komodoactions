name: Deploy Stack Example

on:
  push:
    branches: [main]
  workflow_dispatch:
    inputs:
      stack-name:
        description: 'Stack name to deploy'
        required: true
        default: 'dev-pijatmu'
      services:
        description: 'Services to deploy (comma-separated, leave empty for all)'
        required: false
        default: 'app'

jobs:
  deploy:
    runs-on: ubuntu-latest
    name: Deploy to Komodo

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Deploy Stack
        id: deploy
        uses: ./
        with:
          komodo-url: ${{ secrets.KOMODO_URL }}
          api-key: ${{ secrets.KOMODO_API_KEY }}
          api-secret: ${{ secrets.KOMODO_API_SECRET }}
          stack-name: ${{ github.event.inputs.stack-name || 'dev-pijatmu' }}
          services: ${{ github.event.inputs.services || 'app' }}
          wait-for-completion: 'true'
          show-logs: 'true'

      - name: Deploy Result
        run: |
          echo "âœ“ Deployment successful!"
          echo "Update ID: ${{ steps.deploy.outputs.update-id }}"
          echo "Status: ${{ steps.deploy.outputs.status }}"
